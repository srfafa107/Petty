<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏Ç‡∏≤‡∏¢‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á | Pet Shop Assistant</title>
  <meta name="description" content="‡πÄ‡∏ß‡πá‡∏ö‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏Ç‡∏≤‡∏¢‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ ‡∏Å‡∏£‡∏≠‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ‡πÅ‡∏ä‡∏ó‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ ‡πÅ‡∏•‡∏∞‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏µ‡∏¢‡∏ß" />
  <style>
    :root{
      --bg:#0f172a;          /* slate-900 */
      --panel:#111827;       /* gray-900 */
      --muted:#1f2937;       /* gray-800 */
      --card:#0b1224;        /* deep */
      --text:#e5e7eb;        /* gray-200 */
      --text-dim:#cbd5e1;    /* slate-300 */
      --brand:#22c55e;       /* green-500 */
      --brand-2:#06b6d4;     /* cyan-500 */
      --accent:#f59e0b;      /* amber-500 */
      --danger:#ef4444;      /* red-500 */
      --ring: 0 0 0 3px rgba(34,197,94,.35);
      --radius:14px;
      --shadow:0 10px 30px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;background:linear-gradient(180deg,#0b1224,#0e1630 40%,#0f172a);
      color:var(--text); font:16px/1.5 system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans Thai", "Noto Sans", sans-serif;
    }
    a{color:inherit}
    .container{max-width:1200px;margin:auto;padding:20px}
    header{
      position:sticky;top:0;z-index:10;
      background:rgba(15,23,42,.75);backdrop-filter:blur(8px);
      border-bottom:1px solid #1f2937;
    }
    .header-inner{display:flex;gap:12px;align-items:center;justify-content:space-between;padding:12px 20px}
    .logo{display:flex;align-items:center;gap:10px;font-weight:700}
    .logo-badge{width:36px;height:36px;border-radius:12px;display:grid;place-items:center;background:linear-gradient(135deg,var(--brand),var(--brand-2));box-shadow:var(--shadow)}
    .logo-badge span{font-size:20px}
    .quick-actions{display:flex;gap:8px}
    button, .btn{
      appearance:none;border:0;cursor:pointer;
      background:linear-gradient(180deg, #1e293b, #0b1224);
      color:var(--text); padding:10px 14px;border-radius:12px;
      box-shadow:0 4px 18px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.05);
      transition:.18s transform ease,.18s box-shadow ease,.18s background ease;
    }
    button:hover{transform:translateY(-1px)}
    button:focus{outline:none; box-shadow: var(--shadow), var(--ring)}
    .btn-primary{background:linear-gradient(180deg,var(--brand),#15803d); color:#04210f; font-weight:700}
    .btn-danger{background:linear-gradient(180deg,#ef4444,#7f1d1d); color:#fff}
    .layout{
      display:grid; gap:20px; grid-template-columns: 280px 1fr 360px;
      align-items:start; padding:20px;
    }
    @media (max-width: 1100px){
      .layout{grid-template-columns: 1fr; padding:16px}
      .aside-right{order:3}
    }
    .panel{
      background:linear-gradient(180deg,var(--panel),#0b1224);
      border:1px solid #1f2937;border-radius:var(--radius);box-shadow:var(--shadow)
    }
    .panel .head{padding:14px 16px;border-bottom:1px solid #1f2937;display:flex;justify-content:space-between;align-items:center}
    .panel .body{padding:14px 16px}
    .filters .row{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:10px}
    .chip{
      padding:8px 12px;border-radius:999px;background:#0b1224;border:1px solid #1f2937;cursor:pointer;user-select:none
    }
    .chip.active{background:linear-gradient(180deg,#1f2937,#0b1224);border-color:#334155}
    .input, select{
      width:100%; padding:12px 12px;border-radius:12px;border:1px solid #1f2937;background:#0b1224;color:var(--text)
    }
    .input::placeholder{color:#94a3b8}
    .range-wrap{display:flex;gap:10px;align-items:center}
    .range-wrap input[type="number"]{width:100%}
    .product-grid{
      display:grid; gap:14px;
      grid-template-columns: repeat(3, minmax(0,1fr));
    }
    @media (max-width: 900px){ .product-grid{grid-template-columns: repeat(2, minmax(0,1fr));} }
    @media (max-width: 560px){ .product-grid{grid-template-columns: 1fr;} }
    .card{
      background:linear-gradient(180deg,#0b1224,#0a1020);
      border:1px solid #1f2937;border-radius:16px;overflow:hidden;display:flex;flex-direction:column
    }
    .thumb{
      height:150px; display:grid; place-items:center;
      background:radial-gradient(80% 80% at 50% 30%, #0f1c3c, #070b16);
      border-bottom:1px solid #1f2937;
      font-size:50px
    }
    .card .content{padding:12px 14px;display:flex;flex-direction:column;gap:6px}
    .badge{font-size:12px;padding:4px 8px;border-radius:999px;border:1px solid #1f2937;background:#0b1224;width:max-content}
    .price{font-weight:800;font-size:18px}
    .muted{color:var(--text-dim);font-size:13px}
    .card .actions{margin-top:8px;display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .qty{display:flex;align-items:center;gap:6px}
    .qty button{width:28px;height:28px;padding:0;display:grid;place-items:center}
    .aside-right{position:sticky; top:86px}
    .cart-items{display:flex;flex-direction:column; gap:10px; max-height:380px; overflow:auto}
    .cart-item{display:grid;grid-template-columns: 44px 1fr auto; gap:10px; align-items:center; padding:8px;border:1px solid #1f2937;border-radius:12px; background:#0b1224}
    .cart-item .ico{width:44px;height:44px;border-radius:10px;display:grid;place-items:center;background:#0e152a;font-size:22px}
    .subtotal{display:flex;justify-content:space-between;align-items:center;margin-top:12px;padding-top:12px;border-top:1px dashed #334155}
    .checkout{display:flex;gap:8px; margin-top:10px}
    .empty{color:#94a3b8;text-align:center;padding:14px}
    /* Chat Assistant */
    .chat-wrap{height:480px;display:flex;flex-direction:column}
    .messages{flex:1;overflow:auto;display:flex;flex-direction:column;gap:10px;padding:10px}
    .bubble{max-width:85%;padding:10px 12px;border-radius:14px;line-height:1.4; box-shadow:var(--shadow)}
    .bot{align-self:flex-start;background:#0e152a;border:1px solid #1f2937}
    .user{align-self:flex-end;background:linear-gradient(180deg,#1e293b,#0b1224);border:1px solid #1f2937}
    .composer{display:flex;gap:8px;padding:10px;border-top:1px solid #1f2937}
    .composer input{flex:1}
    .suggest{display:flex;gap:6px;flex-wrap:wrap;padding:8px 10px;border-top:1px dashed #334155}
    .suggest .chip{background:#0e152a}
    .small{font-size:12px;color:#94a3b8}
    .sr-only{position:absolute;left:-9999px}
  </style>
</head>
<body>
  <header>
    <div class="header-inner">
      <div class="logo" aria-label="‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á">
        <div class="logo-badge" aria-hidden="true"><span>üêæ</span></div>
        <div>
          <div>Pet Shop Assistant</div>
          <div class="small">‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏Ç‡∏≤‡∏¢‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á</div>
        </div>
      </div>
      <div class="quick-actions">
        <button id="resetFiltersBtn" title="‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á">‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á</button>
        <button id="clearCartTop" class="btn-danger" title="‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤">‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</button>
      </div>
    </div>
  </header>

  <main class="container">
    <div class="layout">
      <!-- Left: Filters -->
      <aside class="panel filters" aria-label="‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤">
        <div class="head"><strong>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ & ‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á</strong></div>
        <div class="body">
          <label class="sr-only" for="search">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</label>
          <input id="search" class="input" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤, ‡∏Ñ‡∏≥‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç ‡πÄ‡∏ä‡πà‡∏ô '‡∏Ç‡∏ô‡∏•‡πà‡∏ß‡∏á', '‡∏•‡∏π‡∏Å‡∏™‡∏∏‡∏ô‡∏±‡∏Ç'‚Ä¶" />
          <div class="row">
            <div class="badge">‡∏ä‡∏ô‡∏¥‡∏î‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á</div>
            <div id="petTypeChips" class="row"></div>
          </div>
          <div class="row">
            <div class="badge">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</div>
            <div id="categoryChips" class="row"></div>
          </div>
          <div class="row">
            <div class="badge">‡∏ä‡πà‡∏ß‡∏á‡∏£‡∏≤‡∏Ñ‡∏≤ (‡∏ø)</div>
            <div class="range-wrap">
              <input id="minPrice" type="number" class="input" min="0" step="10" placeholder="‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î">
              <span>‚Äî</span>
              <input id="maxPrice" type="number" class="input" min="0" step="10" placeholder="‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î">
            </div>
          </div>
          <div class="row">
            <label class="badge" for="sortBy">‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°</label>
            <select id="sortBy">
              <option value="featured">‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</option>
              <option value="priceAsc">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≥‚Üí‡∏™‡∏π‡∏á</option>
              <option value="priceDesc">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏π‡∏á‚Üí‡∏ï‡πà‡∏≥</option>
              <option value="rating">‡πÄ‡∏£‡∏ï‡∏ï‡∏¥‡πâ‡∏á</option>
            </select>
          </div>
          <div class="row">
            <button id="applyFilters" class="btn-primary" aria-label="‡πÉ‡∏ä‡πâ‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á">‡πÉ‡∏ä‡πâ‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á</button>
          </div>
          <div class="small">‡πÄ‡∏Ñ‡∏•‡πá‡∏î‡∏•‡∏±‡∏ö: ‡∏û‡∏¥‡∏°‡∏û‡πå ‚Äú‡πÅ‡∏û‡πâ‡πÑ‡∏Å‡πà‚Äù, ‚Äú‡∏•‡∏î‡∏Å‡∏•‡∏¥‡πà‡∏ô‚Äù, ‚Äú‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡∏´‡∏π‚Äù ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏ö‡∏ö‡∏â‡∏•‡∏≤‡∏î</div>
        </div>
      </aside>

      <!-- Middle: Products -->
      <section class="panel" aria-label="‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤">
        <div class="head">
          <strong>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</strong>
          <div class="small"><span id="countLabel">0</span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
        </div>
        <div class="body">
          <div id="productGrid" class="product-grid" aria-live="polite"></div>
        </div>
      </section>

      <!-- Right: Cart & Chat -->
      <aside class="aside-right">
        <!-- Cart -->
        <section class="panel" aria-label="‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤">
          <div class="head"><strong>‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</strong><span class="small" id="cartCount">(0)</span></div>
          <div class="body">
            <div id="cartItems" class="cart-items"></div>
            <div class="subtotal">
              <div>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°</div>
              <div><strong id="subtotal">‡∏ø0</strong></div>
            </div>
            <div class="checkout">
              <button id="checkoutBtn" class="btn-primary">‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</button>
              <button id="clearCart" class="btn-danger">‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</button>
            </div>
            <div class="small">‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÉ‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ô‡∏µ‡πâ</div>
          </div>
        </section>

        <!-- Chat Assistant -->
        <section class="panel" aria-label="‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡πÅ‡∏ä‡∏ó">
          <div class="head"><strong>‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ü§ñ</strong></div>
          <div class="body chat-wrap">
            <div id="messages" class="messages" aria-live="polite"></div>
            <div class="suggest">
              <div class="chip" data-prompt="‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏™‡∏∏‡∏ô‡∏±‡∏Ç‡∏á‡∏ö 500">‡∏•‡∏π‡∏Å‡∏™‡∏∏‡∏ô‡∏±‡∏Ç ‡∏á‡∏ö 500</div>
              <div class="chip" data-prompt="‡πÅ‡∏°‡∏ß‡∏Ç‡∏ô‡∏¢‡∏≤‡∏ß ‡∏Ç‡∏ô‡∏•‡πà‡∏ß‡∏á‡πÄ‡∏¢‡∏≠‡∏∞ ‡πÉ‡∏ä‡πâ‡∏≠‡∏∞‡πÑ‡∏£‡∏î‡∏µ">‡∏Ç‡∏ô‡∏•‡πà‡∏ß‡∏á‡πÅ‡∏°‡∏ß</div>
              <div class="chip" data-prompt="‡πÅ‡∏°‡∏ß‡πÅ‡∏û‡πâ‡πÑ‡∏Å‡πà ‡∏Ç‡∏≠‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏ï‡∏µ‡∏ô‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å">‡πÅ‡∏û‡πâ‡πÑ‡∏Å‡πà</div>
              <div class="chip" data-prompt="‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡∏ü‡∏±‡∏ô‡∏™‡∏∏‡∏ô‡∏±‡∏Ç ‡∏•‡∏î‡∏Å‡∏•‡∏¥‡πà‡∏ô‡∏õ‡∏≤‡∏Å">‡∏ü‡∏±‡∏ô‡∏™‡∏∏‡∏ô‡∏±‡∏Ç</div>
            </div>
            <div class="composer">
              <input id="chatInput" class="input" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ñ‡∏≤‡∏°‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢ ‡πÄ‡∏ä‡πà‡∏ô ‚Äú‡πÅ‡∏°‡∏ß‡πÅ‡∏û‡πâ‡πÑ‡∏Å‡πà‡∏Ñ‡∏ß‡∏£‡∏Å‡∏¥‡∏ô‡∏≠‡∏∞‡πÑ‡∏£‡∏î‡∏µ ‡∏á‡∏ö‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 400‚Äù">
              <button id="sendBtn" class="btn-primary">‡∏™‡πà‡∏á</button>
            </div>
          </div>
        </section>
      </aside>
    </div>
  </main>

  <template id="cardTpl">
    <article class="card" role="article">
      <div class="thumb" aria-hidden="true"></div>
      <div class="content">
        <div class="badge"></div>
        <div class="title" style="font-weight:700"></div>
        <div class="muted desc"></div>
        <div class="muted">‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö: <span class="fit"></span></div>
        <div class="price"></div>
        <div class="muted">‚≠ê <span class="rating"></span> | ‡∏™‡πà‡∏á‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 2‚Äì3 ‡∏ß‡∏±‡∏ô</div>
        <div class="actions">
          <div class="qty">
            <button class="dec" aria-label="‡∏•‡∏î‡∏à‡∏≥‡∏ô‡∏ß‡∏ô">‚àí</button>
            <span class="qv">1</span>
            <button class="inc" aria-label="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô">Ôºã</button>
          </div>
          <button class="add btn-primary">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</button>
        </div>
      </div>
    </article>
  </template>

  <script>
    /***************
     * Mock Catalog
     ***************/
    const PRODUCTS = [
      {id:'FDK-001', name:'‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏°‡πá‡∏î‡∏•‡∏π‡∏Å‡∏™‡∏∏‡∏ô‡∏±‡∏Ç ‡∏™‡∏π‡∏ï‡∏£‡∏¢‡πà‡∏≠‡∏¢‡∏á‡πà‡∏≤‡∏¢', emoji:'ü¶¥', pet:'‡∏™‡∏∏‡∏ô‡∏±‡∏Ç', category:'‡∏≠‡∏≤‡∏´‡∏≤‡∏£', price:329, rating:4.6,
       tags:['‡∏•‡∏π‡∏Å‡∏™‡∏∏‡∏ô‡∏±‡∏Ç','‡∏¢‡πà‡∏≠‡∏¢‡∏á‡πà‡∏≤‡∏¢','‡πÑ‡∏Å‡πà','‡πÇ‡∏≠‡πÄ‡∏°‡∏Å‡πâ‡∏≤-3'], fit:'‡∏•‡∏π‡∏Å‡∏™‡∏∏‡∏ô‡∏±‡∏Ç‡∏≠‡∏≤‡∏¢‡∏∏ 2‚Äì12 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô', desc:'‡πÇ‡∏õ‡∏£‡∏ï‡∏µ‡∏ô‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û ‡∏à‡∏≤‡∏Å‡πÑ‡∏Å‡πà + ‡∏û‡∏£‡∏µ‡πÑ‡∏ö‡πÇ‡∏≠‡∏ï‡∏¥‡∏Å'},
      {id:'FDC-002', name:'‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÅ‡∏°‡∏ß‡πÅ‡∏û‡πâ‡∏á‡πà‡∏≤‡∏¢ ‡∏™‡∏π‡∏ï‡∏£‡∏õ‡∏•‡∏≤‡∏ó‡∏π‡∏ô‡πà‡∏≤', emoji:'üêü', pet:'‡πÅ‡∏°‡∏ß', category:'‡∏≠‡∏≤‡∏´‡∏≤‡∏£', price:389, rating:4.7,
       tags:['‡πÅ‡∏û‡πâ‡πÑ‡∏Å‡πà','‡∏Ç‡∏ô‡∏™‡∏ß‡∏¢','‡∏¢‡πà‡∏≠‡∏¢‡∏á‡πà‡∏≤‡∏¢','‡∏õ‡∏•‡∏≤'], fit:'‡πÅ‡∏°‡∏ß‡πÇ‡∏ï‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ', desc:'‡πÇ‡∏õ‡∏£‡∏ï‡∏µ‡∏ô‡∏à‡∏≤‡∏Å‡∏õ‡∏•‡∏≤‡∏ó‡∏π‡∏ô‡πà‡∏≤ ‡∏•‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡πâ‡πÑ‡∏Å‡πà'},
      {id:'TRT-003', name:'‡∏Ç‡∏ô‡∏°‡∏™‡∏∏‡∏ô‡∏±‡∏Ç ‡πÄ‡∏î‡∏ô‡∏ó‡∏±‡∏•‡∏ä‡∏¥‡∏ß ‡∏•‡∏î‡∏Å‡∏•‡∏¥‡πà‡∏ô‡∏õ‡∏≤‡∏Å', emoji:'ü™•', pet:'‡∏™‡∏∏‡∏ô‡∏±‡∏Ç', category:'‡∏Ç‡∏≠‡∏á‡∏Å‡∏¥‡∏ô‡πÄ‡∏•‡πà‡∏ô', price:149, rating:4.5,
       tags:['‡∏ü‡∏±‡∏ô','‡∏Å‡∏•‡∏¥‡πà‡∏ô‡∏õ‡∏≤‡∏Å','‡πÄ‡∏î‡∏ô‡∏ó‡∏±‡∏•'], fit:'‡∏™‡∏∏‡∏ô‡∏±‡∏Ç‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏¢', desc:'‡πÄ‡∏Ñ‡∏µ‡πâ‡∏¢‡∏ß‡πÄ‡∏û‡∏•‡∏¥‡∏ô ‡∏•‡∏î‡∏Ñ‡∏£‡∏≤‡∏ö‡∏´‡∏¥‡∏ô‡∏õ‡∏π‡∏ô'},
      {id:'TOY-004', name:'‡∏Ç‡∏≠‡∏á‡πÄ‡∏•‡πà‡∏ô‡πÅ‡∏°‡∏ß ‡πÑ‡∏°‡πâ‡∏•‡πà‡∏≠‡∏Ç‡∏ô‡∏ô‡∏Å', emoji:'ü™∂', pet:'‡πÅ‡∏°‡∏ß', category:'‡∏Ç‡∏≠‡∏á‡πÄ‡∏•‡πà‡∏ô', price:89, rating:4.4,
       tags:['‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢','‡∏Ç‡∏≠‡∏á‡πÄ‡∏•‡πà‡∏ô','‡πÅ‡∏°‡∏ß‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏™‡∏π‡∏á'], fit:'‡πÅ‡∏°‡∏ß‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏¢', desc:'‡∏Ç‡∏ô‡∏ô‡∏Å‡πÄ‡∏î‡πâ‡∏á‡πÑ‡∏ß ‡∏Å‡∏£‡∏∞‡∏ï‡∏∏‡πâ‡∏ô‡∏™‡∏±‡∏ç‡∏ä‡∏≤‡∏ï‡∏ç‡∏≤‡∏ì'},
      {id:'GRM-005', name:'‡πÅ‡∏õ‡∏£‡∏á‡∏Å‡∏≥‡∏à‡∏±‡∏î‡∏Ç‡∏ô‡∏£‡πà‡∏ß‡∏á ‡πÅ‡∏°‡∏ß‡∏Ç‡∏ô‡∏¢‡∏≤‡∏ß', emoji:'üß§', pet:'‡πÅ‡∏°‡∏ß', category:'‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå', price:219, rating:4.8,
       tags:['‡∏Ç‡∏ô‡∏•‡πà‡∏ß‡∏á','‡∏Ç‡∏ô‡∏¢‡∏≤‡∏ß','‡∏Å‡∏£‡∏π‡∏°‡∏°‡∏¥‡πà‡∏á'], fit:'‡πÅ‡∏°‡∏ß‡∏Ç‡∏ô‡∏¢‡∏≤‡∏ß/‡∏´‡∏ô‡∏≤', desc:'‡∏î‡∏∂‡∏á‡∏Ç‡∏ô‡∏ä‡∏±‡πâ‡∏ô‡πÉ‡∏ï‡πâ ‡∏•‡∏î‡∏Å‡πâ‡∏≠‡∏ô‡∏Ç‡∏ô'},
      {id:'BTH-006', name:'‡πÅ‡∏ä‡∏°‡∏û‡∏π‡∏™‡∏∏‡∏ô‡∏±‡∏Ç ‡∏ú‡∏¥‡∏ß‡πÅ‡∏û‡πâ‡∏á‡πà‡∏≤‡∏¢ Oat', emoji:'ü´ß', pet:'‡∏™‡∏∏‡∏ô‡∏±‡∏Ç', category:'‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå', price:259, rating:4.6,
       tags:['‡∏ú‡∏¥‡∏ß‡πÅ‡∏û‡πâ‡∏á‡πà‡∏≤‡∏¢','‡πÇ‡∏≠‡πä‡∏ï‡∏°‡∏µ‡∏•','‡∏•‡∏î‡∏Ñ‡∏±‡∏ô'], fit:'‡∏™‡∏∏‡∏ô‡∏±‡∏Ç‡∏ú‡∏¥‡∏ß‡πÅ‡∏û‡πâ‡∏á‡πà‡∏≤‡∏¢', desc:'‡∏™‡∏π‡∏ï‡∏£‡∏≠‡πà‡∏≠‡∏ô‡πÇ‡∏¢‡∏ô pH-balanced'},
      {id:'SAN-007', name:'‡∏ó‡∏£‡∏≤‡∏¢‡πÅ‡∏°‡∏ß‡∏à‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡πÅ‡∏ô‡πà‡∏ô ‡∏Å‡∏•‡∏¥‡πà‡∏ô‡∏•‡∏≤‡πÄ‡∏ß‡∏ô‡πÄ‡∏î‡∏≠‡∏£‡πå', emoji:'ü™®', pet:'‡πÅ‡∏°‡∏ß', category:'‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå', price:179, rating:4.3,
       tags:['‡∏î‡∏π‡∏î‡∏ã‡∏±‡∏ö‡∏Å‡∏•‡∏¥‡πà‡∏ô','‡∏à‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡πÅ‡∏ô‡πà‡∏ô','‡∏•‡∏≤‡πÄ‡∏ß‡∏ô‡πÄ‡∏î‡∏≠‡∏£‡πå'], fit:'‡πÅ‡∏°‡∏ß‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏¢', desc:'‡πÄ‡∏Å‡πá‡∏ö‡∏Å‡∏•‡∏¥‡πà‡∏ô‡∏î‡∏µ ‡∏ù‡∏∏‡πà‡∏ô‡∏ï‡πà‡∏≥'},
      {id:'BWL-008', name:'‡∏ä‡∏≤‡∏°‡∏™‡πÅ‡∏ï‡∏ô‡πÄ‡∏•‡∏™‡∏Å‡∏±‡∏ô‡∏•‡πâ‡∏° 1 ‡∏•‡∏¥‡∏ï‡∏£', emoji:'ü•£', pet:'‡∏™‡∏∏‡∏ô‡∏±‡∏Ç', category:'‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå', price:129, rating:4.4,
       tags:['‡∏Å‡∏±‡∏ô‡∏•‡∏∑‡πà‡∏ô','‡∏™‡πÄ‡∏ï‡∏ô‡πÄ‡∏•‡∏™','‡∏ó‡∏ô‡∏ó‡∏≤‡∏ô'], fit:'‡∏™‡∏∏‡∏ô‡∏±‡∏Ç‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå‡∏Å‡∏•‡∏≤‡∏á', desc:'‡∏ê‡∏≤‡∏ô‡∏¢‡∏≤‡∏á‡∏Å‡∏±‡∏ô‡∏•‡∏∑‡πà‡∏ô ‡∏•‡πâ‡∏≤‡∏á‡∏á‡πà‡∏≤‡∏¢'},
      {id:'SUP-009', name:'‡πÄ‡∏à‡∏•‡∏õ‡∏•‡∏≤‡∏ó‡∏π‡∏ô‡πà‡∏≤ ‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏Ç‡∏ô‡πÅ‡∏•‡∏∞‡∏ú‡∏¥‡∏ß', emoji:'‚ú®', pet:'‡πÅ‡∏°‡∏ß', category:'‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏™‡∏£‡∏¥‡∏°', price:199, rating:4.5,
       tags:['‡∏Ç‡∏ô‡πÄ‡∏á‡∏≤','‡πÇ‡∏≠‡πÄ‡∏°‡∏Å‡πâ‡∏≤','‡∏ß‡∏¥‡∏ï‡∏≤‡∏°‡∏¥‡∏ô'], fit:'‡πÅ‡∏°‡∏ß‡πÇ‡∏ï', desc:'‡πÇ‡∏≠‡πÄ‡∏°‡∏Å‡πâ‡∏≤ 3-6-9 ‡∏ä‡πà‡∏ß‡∏¢‡∏ú‡∏¥‡∏ß‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏î‡∏µ'},
      {id:'TRT-010', name:'‡∏Ç‡∏ô‡∏°‡πÅ‡∏°‡∏ß‡πÄ‡∏•‡∏µ‡∏¢ ‡∏™‡∏π‡∏ï‡∏£‡∏Ñ‡∏≠‡∏ô‡∏ã‡∏π‡πÄ‡∏°‡πà', emoji:'üçÆ', pet:'‡πÅ‡∏°‡∏ß', category:'‡∏Ç‡∏≠‡∏á‡∏Å‡∏¥‡∏ô‡πÄ‡∏•‡πà‡∏ô', price:99, rating:4.7,
       tags:['‡∏Ç‡∏ô‡∏°‡πÄ‡∏•‡∏µ‡∏¢','‡∏ó‡∏≤‡∏ô‡πÄ‡∏•‡πà‡∏ô','‡πÉ‡∏´‡πâ‡∏¢‡∏≤'], fit:'‡πÅ‡∏°‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏¥‡∏ô', desc:'‡∏´‡∏≠‡∏° ‡∏≠‡∏£‡πà‡∏≠‡∏¢ ‡∏ä‡πà‡∏ß‡∏¢‡∏ã‡πà‡∏≠‡∏ô‡∏¢‡∏≤'}
    ];

    const PET_TYPES = ['‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î','‡∏™‡∏∏‡∏ô‡∏±‡∏Ç','‡πÅ‡∏°‡∏ß'];
    const CATEGORIES = ['‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î','‡∏≠‡∏≤‡∏´‡∏≤‡∏£','‡∏Ç‡∏≠‡∏á‡∏Å‡∏¥‡∏ô‡πÄ‡∏•‡πà‡∏ô','‡∏Ç‡∏≠‡∏á‡πÄ‡∏•‡πà‡∏ô','‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå','‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏™‡∏£‡∏¥‡∏°'];

    /***************
     * State
     ***************/
    const state = {
      search:'',
      petType:'‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î',
      category:'‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î',
      minPrice:null,
      maxPrice:null,
      sort:'featured',
      qtyMap:{}, // id -> qty (card UI)
      cart: JSON.parse(localStorage.getItem('pet_cart')||'[]')
    };

    /***************
     * DOM Helpers
     ***************/
    const $ = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));

    function baht(n){ return '‡∏ø' + n.toLocaleString('th-TH'); }

    function saveCart(){
      localStorage.setItem('pet_cart', JSON.stringify(state.cart));
      renderCart();
    }

    /***************
     * Filters UI
     ***************/
    function renderChips(){
      const petWrap = $('#petTypeChips');
      petWrap.innerHTML='';
      PET_TYPES.forEach(p=>{
        const el = document.createElement('div');
        el.className='chip'+(state.petType===p?' active':'');
        el.textContent=p;
        el.role='button'; el.tabIndex=0;
        el.addEventListener('click',()=>{ state.petType=p; renderChips(); renderProducts(); });
        petWrap.appendChild(el);
      });

      const catWrap = $('#categoryChips');
      catWrap.innerHTML='';
      CATEGORIES.forEach(c=>{
        const el = document.createElement('div');
        el.className='chip'+(state.category===c?' active':'');
        el.textContent=c;
        el.addEventListener('click',()=>{ state.category=c; renderChips(); renderProducts(); });
        catWrap.appendChild(el);
      });
    }

    /***************
     * Product List
     ***************/
    function filterProducts(){
      const q = state.search.trim().toLowerCase();
      let list = PRODUCTS.filter(p=>{
        const inPet = state.petType==='‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î' || p.pet===state.petType;
        const inCat = state.category==='‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î' || p.category===state.category;
        const inPrice = (state.minPrice==null || p.price>=state.minPrice) &&
                        (state.maxPrice==null || p.price<=state.maxPrice);
        const inText = !q || [p.name,p.desc,p.fit,...p.tags].join(' ').toLowerCase().includes(q);
        return inPet && inCat && inPrice && inText;
      });

      switch(state.sort){
        case 'priceAsc': list.sort((a,b)=>a.price-b.price); break;
        case 'priceDesc': list.sort((a,b)=>b.price-a.price); break;
        case 'rating': list.sort((a,b)=>b.rating-a.rating); break;
        default: list.sort((a,b)=>b.rating - a.rating/10 - a.price/10000); // pseudo-featured
      }
      return list;
    }

    function renderProducts(){
      const grid = $('#productGrid');
      grid.innerHTML='';
      const list = filterProducts();
      $('#countLabel').textContent = list.length;
      list.forEach(p=>{
        const tpl = document.getElementById('cardTpl').content.cloneNode(true);
        const card = tpl.querySelector('.card');
        tpl.querySelector('.thumb').textContent = p.emoji;
        tpl.querySelector('.badge').textContent = `${p.pet} ‚Ä¢ ${p.category}`;
        tpl.querySelector('.title').textContent = p.name;
        tpl.querySelector('.desc').textContent = p.desc;
        tpl.querySelector('.fit').textContent = p.fit;
        tpl.querySelector('.price').textContent = baht(p.price);
        tpl.querySelector('.rating').textContent = `${p.rating.toFixed(1)}`;

        const qv = tpl.querySelector('.qv');
        const inc = tpl.querySelector('.inc');
        const dec = tpl.querySelector('.dec');
        const add = tpl.querySelector('.add');

        let q = state.qtyMap[p.id] || 1;
        qv.textContent = q;

        inc.addEventListener('click',()=>{ q=Math.min(99,q+1); state.qtyMap[p.id]=q; qv.textContent=q; });
        dec.addEventListener('click',()=>{ q=Math.max(1,q-1); state.qtyMap[p.id]=q; qv.textContent=q; });

        add.addEventListener('click',()=>{
          const exist = state.cart.find(it=>it.id===p.id);
          if(exist) exist.qty = Math.min(99, exist.qty + q);
          else state.cart.push({id:p.id, name:p.name, emoji:p.emoji, price:p.price, qty:q});
          saveCart();
          animateAdd(card);
        });

        grid.appendChild(tpl);
      });

      if(list.length===0){
        grid.innerHTML = `<div class="empty">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ ‡∏•‡∏≠‡∏á‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏≠‡∏∑‡πà‡∏ô ‡πÜ</div>`;
      }
    }

    function animateAdd(el){
      el.style.transform='scale(0.98)';
      el.style.transition='.12s';
      setTimeout(()=>{ el.style.transform=''; }, 150);
    }

    /***************
     * Cart
     ***************/
    function renderCart(){
      const wrap = $('#cartItems');
      wrap.innerHTML='';
      if(state.cart.length===0){
        wrap.innerHTML = `<div class="empty">‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤ üõí</div>`;
      }
      let sum = 0;
      state.cart.forEach((it,i)=>{
        sum += it.price*it.qty;
        const row = document.createElement('div');
        row.className='cart-item';
        row.innerHTML = `
          <div class="ico" aria-hidden="true">${it.emoji}</div>
          <div>
            <div style="font-weight:700">${it.name}</div>
            <div class="small">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô x${it.qty} ‚Ä¢ ${baht(it.price)}</div>
          </div>
          <div style="display:flex;gap:6px">
            <button aria-label="‡∏•‡∏î‡∏à‡∏≥‡∏ô‡∏ß‡∏ô" data-i="${i}" data-act="dec">‚àí</button>
            <button aria-label="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô" data-i="${i}" data-act="inc">Ôºã</button>
            <button class="btn-danger" aria-label="‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤" data-i="${i}" data-act="del">‡∏•‡∏ö</button>
          </div>`;
        row.addEventListener('click', e=>{
          const btn = e.target.closest('button'); if(!btn) return;
          const idx = +btn.dataset.i, act = btn.dataset.act;
          const item = state.cart[idx];
          if(act==='dec'){ item.qty = Math.max(1, item.qty-1); }
          if(act==='inc'){ item.qty = Math.min(99, item.qty+1); }
          if(act==='del'){ state.cart.splice(idx,1); }
          saveCart();
        });
        wrap.appendChild(row);
      });
      $('#subtotal').textContent = baht(sum);
      $('#cartCount').textContent = `(${state.cart.reduce((a,b)=>a+b.qty,0)})`;
    }

    function clearCart(){ state.cart = []; saveCart(); }

    /***************
     * Chat Assistant (Rule-based)
     ***************/
    const messages = $('#messages');

    function botSay(text, options={}){
      const b = document.createElement('div');
      b.className='bubble bot';
      b.innerHTML = text;
      messages.appendChild(b);
      messages.scrollTop = messages.scrollHeight;
      if(options.attachProducts) renderSuggestProducts(options.attachProducts);
    }

    function userSay(text){
      const u = document.createElement('div');
      u.className='bubble user';
      u.textContent = text;
      messages.appendChild(u);
      messages.scrollTop = messages.scrollHeight;
    }

    function renderSuggestProducts(list){
      const wrap = document.createElement('div');
      wrap.style.marginTop='8px';
      wrap.innerHTML = `<div class="small">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:</div>`;
      list.slice(0,3).forEach(p=>{
        const row = document.createElement('div');
        row.className='small';
        row.style.marginTop='4px';
        row.innerHTML = `‚Ä¢ ${p.emoji} <strong>${p.name}</strong> ‚Äî ${baht(p.price)} 
          <button class="btn" data-id="${p.id}" style="margin-left:6px">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</button>`;
        row.querySelector('button').addEventListener('click',()=>{
          const exist = state.cart.find(it=>it.id===p.id);
          if(exist) exist.qty = Math.min(99, exist.qty + 1);
          else state.cart.push({id:p.id, name:p.name, emoji:p.emoji, price:p.price, qty:1});
          saveCart();
        });
        wrap.appendChild(row);
      });
      const host = document.createElement('div');
      host.className='bubble bot';
      host.appendChild(wrap);
      messages.appendChild(host);
      messages.scrollTop = messages.scrollHeight;
    }

    function scoreProduct(p, ctx){
      let s = 0;
      if(ctx.pet && p.pet===ctx.pet) s += 3;
      if(ctx.category && p.category===ctx.category) s += 2;
      if(ctx.maxPrice && p.price<=ctx.maxPrice) s += 2;
      if(ctx.minPrice && p.price>=ctx.minPrice) s += 1;
      ctx.keywords.forEach(k=>{
        if((p.name+p.desc+p.fit+p.tags.join(' ')).toLowerCase().includes(k)) s += 1.2;
      });
      return s + p.rating/2; // bias to rating
    }

    function parseContext(text){
      text = text.toLowerCase();
      const ctx = {pet:null, category:null, minPrice:null, maxPrice:null, keywords:[]};

      if(/‡∏™‡∏∏‡∏ô‡∏±‡∏Ç|‡∏´‡∏°‡∏≤/.test(text)) ctx.pet='‡∏™‡∏∏‡∏ô‡∏±‡∏Ç';
      if(/‡πÅ‡∏°‡∏ß/.test(text)) ctx.pet='‡πÅ‡∏°‡∏ß';

      if(/‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏™‡∏£‡∏¥‡∏°/.test(text)) ctx.category='‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏™‡∏£‡∏¥‡∏°';
      else if(/‡∏Ç‡∏≠‡∏á‡πÄ‡∏•‡πà‡∏ô/.test(text)) ctx.category='‡∏Ç‡∏≠‡∏á‡πÄ‡∏•‡πà‡∏ô';
      else if(/‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå|‡∏Å‡∏£‡∏π‡∏°|‡πÅ‡∏ä‡∏°‡∏û‡∏π|‡πÅ‡∏õ‡∏£‡∏á|‡∏ó‡∏£‡∏≤‡∏¢/.test(text)) ctx.category='‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå';
      else if(/‡∏Ç‡∏≠‡∏á‡∏Å‡∏¥‡∏ô‡πÄ‡∏•‡πà‡∏ô|‡∏Ç‡∏ô‡∏°|‡πÄ‡∏î‡∏ô‡∏ó‡∏±‡∏•/.test(text)) ctx.category='‡∏Ç‡∏≠‡∏á‡∏Å‡∏¥‡∏ô‡πÄ‡∏•‡πà‡∏ô';
      else if(/‡∏≠‡∏≤‡∏´‡∏≤‡∏£|‡πÄ‡∏°‡πá‡∏î|‡∏™‡∏π‡∏ï‡∏£/.test(text)) ctx.category='‡∏≠‡∏≤‡∏´‡∏≤‡∏£';

      // ‡∏£‡∏≤‡∏Ñ‡∏≤: ‚Ä¶‡∏á‡∏ö 500 / ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 400 / 200-300
      const m1 = text.match(/‡∏á‡∏ö\s*(\d{2,5})/);
      const m2 = text.match(/‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô\s*(\d{2,5})/);
      const m3 = text.match(/(\d{2,5})\s*[-‚Äì]\s*(\d{2,5})/);
      if(m1) ctx.maxPrice = +m1[1];
      if(m2) ctx.maxPrice = +m2[1];
      if(m3){ ctx.minPrice=+m3[1]; ctx.maxPrice=+m3[2]; }

      // ‡∏Ñ‡∏µ‡∏¢‡πå‡πÄ‡∏ß‡∏¥‡∏£‡πå‡∏î‡∏≠‡∏≤‡∏Å‡∏≤‡∏£/‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥
      const dict = ['‡πÅ‡∏û‡πâ‡πÑ‡∏Å‡πà','‡∏ú‡∏¥‡∏ß‡πÅ‡∏û‡πâ‡∏á‡πà‡∏≤‡∏¢','‡∏Ç‡∏ô‡∏•‡πà‡∏ß‡∏á','‡∏Å‡∏•‡∏¥‡πà‡∏ô‡∏õ‡∏≤‡∏Å','‡∏•‡∏î‡∏Å‡∏•‡∏¥‡πà‡∏ô','‡∏Ç‡∏ô‡∏¢‡∏≤‡∏ß','‡∏¢‡πà‡∏≠‡∏¢‡∏á‡πà‡∏≤‡∏¢','‡∏•‡∏π‡∏Å‡∏™‡∏∏‡∏ô‡∏±‡∏Ç','‡∏•‡∏π‡∏Å‡πÅ‡∏°‡∏ß'];
      dict.forEach(k=>{
        if(text.includes(k)) ctx.keywords.push(k.toLowerCase());
      });

      // ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ
      if(/‡πÇ‡∏õ‡∏£‡πÇ‡∏°|‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î/.test(text)) ctx.faq='promo';
      if(/‡∏™‡πà‡∏á|‡∏à‡∏±‡∏î‡∏™‡πà‡∏á|‡∏Å‡∏µ‡πà‡∏ß‡∏±‡∏ô/.test(text)) ctx.faq='ship';
      if(/‡∏Ñ‡∏∑‡∏ô|‡πÄ‡∏Ñ‡∏•‡∏°|‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô/.test(text)) ctx.faq='return';

      return ctx;
    }

    function reply(text){
      const ctx = parseContext(text);

      if(ctx.faq==='promo'){
        botSay('üéâ ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡πÇ‡∏õ‡∏£‡∏™‡πà‡∏á‡∏ü‡∏£‡∏µ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏¢‡∏≠‡∏î‡∏Ñ‡∏£‡∏ö ‡∏ø499 ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏•‡∏î 5% ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà (‡πÇ‡∏Ñ‡πâ‡∏î: <code>PETNEW5</code>)');
        return;
      }
      if(ctx.faq==='ship'){
        botSay('üöö ‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 2‚Äì3 ‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ ‡∏ó‡∏±‡πà‡∏ß‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏® ‡∏°‡∏µ‡πÄ‡∏Å‡πá‡∏ö‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á‡πÑ‡∏î‡πâ‡∏Ñ‡πà‡∏∞');
        return;
      }
      if(ctx.faq==='return'){
        botSay('üîÅ ‡∏Ñ‡∏∑‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÑ‡∏î‡πâ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 7 ‡∏ß‡∏±‡∏ô ‡∏´‡∏≤‡∏Å‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÅ‡∏Å‡∏∞‡∏ã‡∏µ‡∏•/‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏ô‡∏™‡πà‡∏á ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÅ‡∏ä‡∏ó‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢');
        return;
      }

      // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÅ‡∏•‡∏∞‡∏Ñ‡∏±‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
      const scored = PRODUCTS
        .map(p=>({p, s:scoreProduct(p, ctx)}))
        .sort((a,b)=>b.s-a.s)
        .slice(0,3)
        .map(x=>x.p);

      if(scored.length){
        let intro = '‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì:';
        if(ctx.pet) intro = `‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö${ctx.pet}${ctx.maxPrice?` ‡∏á‡∏ö‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô ${baht(ctx.maxPrice)}`:''} ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ`;
        botSay(intro, {attachProducts: scored});
      }else{
        botSay('‡∏Ç‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏µ‡∏Å‡∏ô‡∏¥‡∏î ‡πÄ‡∏ä‡πà‡∏ô ‡∏ä‡∏ô‡∏¥‡∏î‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á / ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì / ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ ‡πÅ‡∏•‡πâ‡∏ß‡∏â‡∏±‡∏ô‡∏à‡∏∞‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏Ñ‡πà‡∏∞');
      }
    }

    /***************
     * Events
     ***************/
    function initEvents(){
      $('#search').addEventListener('input', e=>{ state.search = e.target.value; renderProducts(); });
      $('#minPrice').addEventListener('input', e=>{ state.minPrice = e.target.value? +e.target.value : null; });
      $('#maxPrice').addEventListener('input', e=>{ state.maxPrice = e.target.value? +e.target.value : null; });
      $('#sortBy').addEventListener('change', e=>{ state.sort = e.target.value; renderProducts(); });
      $('#applyFilters').addEventListener('click', renderProducts);
      $('#resetFiltersBtn').addEventListener('click', ()=>{
        state.search=''; $('#search').value='';
        state.petType='‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î'; state.category='‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î'; renderChips();
        state.minPrice=null; state.maxPrice=null; $('#minPrice').value=''; $('#maxPrice').value='';
        state.sort='featured'; $('#sortBy').value='featured';
        renderProducts();
      });

      $('#checkoutBtn').addEventListener('click', ()=>{
        if(state.cart.length===0){ alert('‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏¢‡∏±‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏≠‡∏¢‡∏π‡πà'); return; }
        const items = state.cart.map(i=>`‚Ä¢ ${i.name} x${i.qty} = ${baht(i.price*i.qty)}`).join('\n');
        const sum = state.cart.reduce((t,i)=>t+i.price*i.qty,0);
        alert(`‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠\n\n${items}\n\n‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: ${baht(sum)}\n\n*‡∏ô‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏î‡πÇ‡∏° ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏à‡∏£‡∏¥‡∏á`);
      });

      $('#clearCart').addEventListener('click', ()=>{ if(confirm('‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?')) clearCart(); });
      $('#clearCartTop').addEventListener('click', ()=>{ if(confirm('‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?')) clearCart(); });

      // Chat
      $('#sendBtn').addEventListener('click', ()=>{
        const text = $('#chatInput').value.trim();
        if(!text) return;
        userSay(text);
        $('#chatInput').value='';
        setTimeout(()=>reply(text), 200);
      });
      $('#chatInput').addEventListener('keydown', e=>{
        if(e.key==='Enter'){ e.preventDefault(); $('#sendBtn').click(); }
      });
      $$('.suggest .chip').forEach(c=>{
        c.addEventListener('click', ()=>{ $('#chatInput').value = c.dataset.prompt; $('#sendBtn').click(); });
      });
    }

    /***************
     * Boot
     ***************/
    function boot(){
      renderChips();
      renderProducts();
      renderCart();
      initEvents();
      botSay('‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡πà‡∏∞! ‡∏â‡∏±‡∏ô‡∏Ñ‡∏∑‡∏≠‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏£‡πâ‡∏≤‡∏ô‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á üêæ ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ö‡∏≠‡∏Å‡∏â‡∏±‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏ß‡πà‡∏≤‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏™‡∏∏‡∏ô‡∏±‡∏Ç‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏°‡∏ß ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì ‡πÅ‡∏•‡∏∞‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏≤‡∏Å‡πÅ‡∏Å‡πâ ‡πÄ‡∏ä‡πà‡∏ô ‚Äú‡πÅ‡∏°‡∏ß‡πÅ‡∏û‡πâ‡πÑ‡∏Å‡πà ‡∏á‡∏ö 400‚Äù');
    }
    boot();
  </script>
</body>
</html>
